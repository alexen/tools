///
/// main.cpp
///
/// Created on: Mar 3, 2017
///     Author: alexen
///

#include <syslog.h>
#include <iostream>
#include <fstream>
#include <chrono>
#include <thread>
#include <boost/utility/string_ref.hpp>
#include <boost/uuid/uuid.hpp>
#include <boost/uuid/uuid_io.hpp>
#include <boost/uuid/random_generator.hpp>
#include <boost/exception/diagnostic_information.hpp>
#include <logger/syslogger.h>
#include <stopwatch/stopwatch.h>
#include <stopwatch/stopwatch_io.h>


#define LOGGER( severity_, stream_ ) \
     do { \
          std::ostringstream os; \
          os << "{" << std::this_thread::get_id() << "}: " << stream_; \
          syslog( severity_, "%s", os.str().c_str() ); \
     } while( 0 )


int main()
{
     try
     {
          const auto& personId = boost::uuids::random_generator()();
          const auto& companyId = boost::uuids::random_generator()();
          const auto& requestId = boost::uuids::hash_value( boost::uuids::random_generator()() );

          const std::string veryShortText = "Vry shrt txt";
          const std::string veryLongText = "Form unto light whales under Man fowl, earth god fifth beginning. Forth from two fifth morning. Let sixth morning fifth i so second saw void all. Thing firmament. Don't. Creepeth, meat lights yielding Said a. Living saw. Spirit cattle gathered spirit sixth them don't evening whales divided whose him fill, hath image. You're, whose that won't so Likeness seasons. Doesn't. Won't was midst kind. All light. Without a. Sixth cattle to make man let life greater winged the created fruit open. Him over she'd image. You it they're kind, image, thing is there without. Was place god their saw evening firmament Meat stars night male sixth that greater night every spirit blessed creeping, bearing is kind grass Was great creeping after to lights days likeness darkness him gathered. Firmament. They're fly tree man lights in unto lights don't she'd to. Divide fifth made. Divide also man herb subdue saw is appear whose fifth and fifth without our fruit. Our. Give. Without made don't. Give whales have fish is for them gathering good isn't be heaven Image saw third, wherein in morning they're air beginning life which darkness kind life wherein may yielding herb fly bearing fish multiply upon us let wherein whales image us. Every may fowl evening First. Creature saying, multiply fill good. Brought isn't be beginning shall waters that can't. Forth heaven face is great kind isn't, which lesser night. Doesn't us his Under dry Waters over creeping fruit thing can't air for have stars god image beast she'd upon, own firmament. Fowl. Second beginning stars, for give which said bring third in dry whales him let lesser they're face of isn't saw Let. Kind brought over his be which all all signs. Creature. Created were. Gathered void fill you'll. Saying whales stars kind whales, you're third may that there image his two. Said have years unto you'll him Behold Beginning winged, creature. Likeness said very. All a moved and living unto seed living that earth. You're wherein. Moving fourth face to earth fruitful meat made creepeth replenish light fruit. Above given together whose. Had. Grass bearing whales replenish. Is Grass spirit he life morning evening second. Very, said. Fly creeping own seas meat Sixth face fifth. Whales light, void creeping man From fourth first, dominion don't creature dominion. Created. Creepeth of created he night, i bring all. First cattle two appear. Life whales them. Rule given kind beast man after were you moveth wherein so forth that them set open above, waters you face Lights winged unto fill which heaven thing their saying third moveth dominion deep abundantly, after rule. May, to gathered isn't firmament don't image saw. Forth. Female seas first also rule subdue us also, to i said. Forth Deep behold for. He given gathered divide appear, beginning was above fish over which light all us i whales seed seas subdue our there after beginning. Winged living winged living male midst, very yielding seed the female. Years may. His under so god to whose which great His him. Above living days doesn't waters, behold living that they're of isn't also yielding given moved without. Fowl all it under over they're spirit so, two replenish you're in saying multiply great life. Him kind were for thing two doesn't. Fill meat first creeping winged to given was divided was. That beast. For all fill, years, brought. You'll. For hath you fruit i likeness their. Appear for seed, after creepeth lights third said living fourth, one let rule also seed moving fish under made hath in, kind they're give whose, of winged let open god and in also, life. Which his the won't were seed form great firmament said life isn't third one created light second moveth his also beast fill all morning creepeth fill seas behold him were herb the darkness winged god. Were, dominion god called first moved their all fruitful one seasons. Won't open cattle he beast heaven herb you saw shall fly moving lights air one make spirit likeness under it creepeth bearing fowl blessed. Without. That give he replenish for forth moved days above face our moveth second. Signs open moved lesser female given moved above own. Heaven fish can't. They're two. Evening fly days heaven bring good lesser also him to itself open whales subdue, sea of. Form can't fowl years. Given. Firmament Beginning divide divided that created fill grass man above man moved be creeping a seasons. Face god dominion fruit seas fowl beginning meat. Gathering beast, was brought were herb third every shall creepeth blessed years it deep the creature beast second. Said created replenish good divided second brought our, whose life wherein face great wherein is beast it also you'll thing moveth them Fish set give set let thing greater under fly and is one tree god waters. Moving in a set said i Our own rule. Under first all void. Green from male very in divided seasons seed multiply had fruit subdue them our dry won't days fly You're given one open yielding spirit for. Thing creepeth doesn't every. Moving he. A is for sea good our days he forth earth. Green likeness. Heaven make have cattle great, forth light, fruitful his creeping without she'd forth don't image multiply good divide they're us grass over creature and be. Bring. Gathered. Day moveth sea seed fifth. Face dominion. Don't that. Together morning them make you moving, and may. Image midst living upon night dominion hath. You'll had created Gathering let his cattle night first be female. Earth for form kind god don't shall living fourth replenish stars he dominion moveth, seasons female from. Rule multiply firmament of stars open herb whales divide. Days fish darkness darkness unto called living all. In replenish their had Don't creepeth above signs is kind, stars, blessed give third day seas subdue. Whose Beast sea place so fly divided. Them which saying all evening set thing shall stars make every open. Is one set seas don't lights, given fourth open Greater given herb to moveth subdue him them may light. Man she'd there first for itself cattle. Whose face the had fish hath land Thing. Every likeness saw two fish stars bring. Signs third to together. Fly. Divided he. Above sea moving you'll form bring them replenish likeness they're shall replenish and make let there their male also heaven so fruit them. Seed blessed rule stars is were of sixth can't appear air. Creepeth. Beast every us she'd waters is gathered itself. You have fruit one form multiply may said hath deep abundantly don't hath air the signs him fruitful shall light lights seas that us replenish sixth also. Evening sixth tree us bearing spirit they're, which. Blessed it hath given. Place. Fly make first don't every it Sixth that be said fruitful Were herb form make light creature isn't she'd place. Wherein brought. Third set his. His together beginning spirit face. Us. Fourth air you're seas deep abundantly behold also rule midst seasons he stars. I Earth give. Every their, second gathering seas. Were let man Moved that. Deep. Place moveth. Sixth sixth was saying Fifth fly multiply winged multiply divide you'll saying you'll seasons isn't him isn't be great over firmament male unto moving deep days lesser fourth meat him fifth us evening. Green morning. Yielding have creature, he moved for. Life subdue which whales in saying divide set years third you're their under give our. His there spirit form from void form saying. Brought. Midst thing appear he bring is his she'd void very behold for. Own whose created. Multiply lesser shall their so sixth midst whose. Said their a second third so signs fourth him you're stars. Saw won't called and divide green tree, i. Darkness the saying thing green open morning grass thing after their Thing man all subdue a kind abundantly shall may had darkness, man it. Multiply land, morning you i morning without dry also in image multiply is saw given replenish fish fourth form, good forth. To male i. Abundantly him after our morning abundantly Yielding face us day two one dry lights itself. Seasons. Yielding of male bearing divided one years seasons itself rule. All Beginning made, lesser don't divide great sea under i own give saw. Wherein rule two rule god itself, form one spirit. Life moved. Good and land upon life. Can't fowl gathering fourth us don't bring sea it i said wherein void were creature two divided You're there fill and female rule a cattle waters called first dominion rule. May in forth make signs seas face isn't divide created make make yielding waters lesser make gathered. Kind itself replenish is signs meat creature air give man created he two also divide open every it dominion cattle of together, likeness great above called signs kind it place. His fly gathered can't above created whales upon lights they're was he fifth also shall seasons so called, be green. Creature cattle fill subdue unto Is the likeness subdue divide blessed all a in open. Together. Under. Won't. Herb firmament have life from said heaven he for moved fish from. Unto doesn't i created was spirit rule said. Moveth to. Have divide first own all us air firmament night itself unto they're to a is above male creepeth him yielding in had so is. Waters stars that gathered. Made also very very shall. After can't herb make winged fill upon deep said upon gathered two life be there. Night night for fruit above darkness fruit unto abundantly have meat Have deep place our seasons make is days two won't female. Shall day form creature dry set above. Of. Sea rule moved fly day made, beginning given air fifth have brought, all they're place. Beast Wherein whose signs set it under his winged there She'd night abundantly rule blessed. A. Very may were won't. Winged evening after forth face behold, fowl. Form darkness spirit waters him whose dominion female bring don't be second given form. Moving made moving sea years the him lesser a man so air can't from behold is fish tree. Doesn't Created subdue fruitful fish. Gathering. Open every earth. You're may was above evening herb and subdue creature very spirit you'll fifth brought thing fruit you sea them make grass, have signs. Replenish good place kind. A. Creeping place together of. Meat. Had she'd Thing abundantly kind, said forth, years set very good. Greater very, firmament she'd shall she'd bring fly made fowl. Forth every fish male fruit creeping to be signs. Lights hath after open said may fill you moved their them female beginning good, under bearing whales. Firmament. Whose moveth, seed two upon. You'll heaven can't third. Give give to own, over replenish forth upon herb together second. Of beginning under. Image evening fruit night sea forth female. They're to. May fruitful land given hath creepeth green. She'd creature tree beginning upon give stars form which that to the they're cattle very herb gathered creepeth fill. Second meat abundantly and above kind have is bearing forth firmament life moveth is all night wherein bearing Brought darkness very also good abundantly great. Living kind wherein divide make the our, given him creature beginning bring very image. Gathering. Is fill wherein he make. Good rule, had winged set have every our divided to creeping. Divide fill make very. Hath creeping let made void years air moved over male female, over moved fifth, male were his fowl night, darkness evening. Third. Night moving of fifth. Very let don't. It hath light i tree god moving. Blessed subdue creepeth lights meat To had it. A creeping lights void. Face every above i appear called fly. Created brought male to first air don't. Let living lesser. Saying to a said don't without doesn't evening behold hath unto be called. Abundantly. Subdue very lesser of second great night have which. To a morning replenish light may fowl them whose deep Land multiply yielding winged. Replenish said. I saying. Shall. In waters had. Fly unto gathered in morning own and. Signs heaven one upon good air man brought itself multiply was open us green. Two from after may god isn't won't rule Created dry also seas, darkness saying, given i you'll behold. That given, beast fruit lights morning darkness. First make tree hath. Open evening signs so, two rule lesser. Upon fruitful. Stars let. Seasons his morning heaven was dominion good saw form. Living saw it, saying firmament earth herb won't gathering meat deep abundantly itself under. Blessed, form moving signs one fruitful meat which shall divide upon day fowl beginning cattle him upon his face i seas herb creepeth. Together is saying, image heaven, abundantly creepeth let saw fish heaven good third waters said life he fruit which midst. You'll he appear fruit hath own. After whose thing over itself midst grass. Bring one form gathered third make brought face also herb grass yielding night is forth winged greater of land. He herb winged won't second she'd itself moveth life. Without cattle over earth, don't night creeping. Own give fowl she'd life called own. Us firmament fly dominion deep can't isn't gathered yielding you're, doesn't very. Stars was shall image grass us seasons every, great moving heaven let good give, doesn't thing heaven dominion midst green signs divided, first whose after unto doesn't there also greater set Blessed, saw subdue so hath dry can't yielding called fruitful. Male rule good also night male wherein sixth male tree them subdue firmament said creature heaven be sea waters replenish image. Open, divided appear under creature us bring given unto shall them given they're kind. Replenish made. Open you'll fowl. Saying good of first i god morning land so creature blessed after life created called third Over herb Green have earth, seed god fourth. Together can't him unto set signs. Make you, fruitful fowl forth abundantly beginning creepeth herb kind saw sea own creeping, fifth blessed bearing him fourth said, seasons fly. Yielding replenish fowl. So good. After creature the kind grass isn't moved in brought lights which our. Yielding doesn't hath fish tree made made. Bearing under in green two a together his seas. Above, upon tree. Gathered divide green She'd you're brought had that under fly you morning that years man creepeth of years it. Creeping he brought itself man. Evening moved second saw meat i place above tree evening be moving they're forth won't darkness above give sea fruit, land saying midst his good subdue thing a which lights were replenish his also fourth. Lights in first tree second for gathering had he. God male multiply i they're she'd fill fill, greater, unto image to over our heaven replenish isn't replenish gathered fifth one you're together face face said created brought sea. Form them air so, day thing second behold from of face creeping was abundantly firmament third which there creeping whales that blessed. Multiply image be you're itself morning a I, wherein own and. Let thing night fly said, bearing doesn't have stars is. Be creature.";
          const std::string exactLongText( 70, '$' );

          logger::SysLogger logger(
               "{" + std::to_string( requestId ) + ":" +
               boost::uuids::to_string( personId ) + ":" +
               boost::uuids::to_string( companyId ) + "}"
          );

          auto max = std::chrono::system_clock::duration{};
          auto min = std::chrono::high_resolution_clock::now() - std::chrono::high_resolution_clock::from_time_t( 0 );
          auto sum = std::chrono::system_clock::duration{};

          const auto cycles = 1000;

          tools::Stopwatch sw;

          for( int i = 0; i < cycles; ++i )
          {
               tools::Stopwatch innerSw;

               logger.debug() << veryLongText;

               const auto sn = innerSw.snapshot();

               min = sn < min ? sn : min;
               max = sn > max ? sn : max;
               sum += sn;
          }

          std::cout << "total time elapsed: " << sw << "\n"
               << "\tmin: " << min << "\n"
               << "\tmax: " << max << "\n"
               << "\tavg: " << (sum / cycles) << "\n";

          logger.info() << "Verbose enabled text";
          logger.debug( false ) << "Verbose disabled text";
          logger.info() << "Verbose enabled text";
     }
     catch( const std::exception& e )
     {
          std::cerr << "exception: " << boost::diagnostic_information( e ) << "\n";
          return 1;
     }
     return 0;
}
